<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <title>render function</title>
   <script type="text/javascript" src="compiler/lex.js"></script>
   <script type="text/javascript" src="compiler/parser.js"></script>
</head>
<body>
	<div id="root"></div>
</body>
<script>

    var value = `    
    <ul id='main' class='mainList'>
      <li class='my-list'>
            <h1>{a.name} - and okkz  {a.id}</h1> 
            <ul>
                <li>
                 <b>{c.id} sdsd {c.type} sdsdf {name} dasssss asdddddddd</b>  
                </li>
            </ul>
        </li>
    </ul>`;

    var bt = function(name) {
       return (/\{(.*)\}/.test(name))
    },
    cs = function(a, n, b, u) {
        var d = [],
            le = a.length,
            pos = le,
            init = 0;
        for (var i = init; i < pos; i++) {
            var start = a.indexOf('{'),
                end = a.indexOf('}');
            if (start !== -1) {
                var k = a.substr(init, start),
                    k = quot(k);
                    d.push(k)

                var k1 = a.substr(start, (end + 1) - start + 1),
                    k1 = quot(k1)
                d.push(k1)
            } else {
                var k = a.substr(0, le),
                    k = quot(k);
                    
                d.push(k)
                break
            }
            var a = a.substr(end + 2, le)
        }
        var d = d.filter(item => item.trim() !== '');
        return (d)
    },
    Neww= function(val) {
      return { type:"text",value:val}  
    },
    quot = function(k) {
        if(!bt(k)){
            if(k.indexOf('"') == -1){
               k = k.trim().length > 0 ? '"'+k+'"' : k;   
            }
        }
        //.replace(/}|{/g, '')
        return(k);
    },
    applier = function(value) {
        var alldata = lexical_analysis(value);
        alldata.forEach((el , ind )=> {
            if(el.type == 'text' && el.value.trim().length > 0){
                var splits = cs(alldata[ind].value);
                alldata.splice(ind, 1);
                splits.forEach((sp , indx) => {
                    var replacer = Neww(sp);
                    alldata.splice((ind + indx), 0, replacer );
                });
            }else if(el.type == 'text' && el.value.trim().length <= 0){
              alldata.splice(ind , 1)
            }  
        });  
        return(parser(alldata));
    },

    Mygenerator = function Mygenerator(a) {
        return GenerateRenderFunction(a);
    },
    
    syntax = function syntax(type , props , child) {
      return 'm("'+type+'",'+JSON.stringify(props)+','+(child)+')';    
    },

    GenerateRenderFunction = function GenerateRenderFunction(x) {
        var store         = [];
        if(typeof(x) == 'object'){
            var children  = x.children;
            for (let i = 0; i < children.length; i++) {
                var el     =  children[i],
                    data   =  GenerateRenderFunction(el),
                    synt = el.type !== undefined && el.props !== undefined ? syntax(el.type , el.props , data) : data;
                    store.push(synt)
            }
        }else{
            store.push(x)
        }
        
        return(store);
    }

    

   var AST = applier(value);//Ast of HTML //this need to be converted to render function
   var datax = Mygenerator(AST)//trying to generate render function //my try
   console.log(datax[0])
//console.log(datax)

//render Function:-
//
//
// render(
//   "ul",
//   { id: "main" },
//   render(
//     "li",
//     { class: "my-list" },
//     render("h1", null, a.name, " -  ", a.id),
//     render(
//       "ul",
//       null,
//       render(
//         "li",
//         null,
//         render("b", null, c.id, "  ", c.type)
//       )
//     )
//   )
// );
//
//
//
//html that need to be converted to render functions:-
//
// <ul id='main'>
//       <li class='my-list'>
//             <h1>{a.name} -  {a.id}</h1> 
//             <ul>
//                 <li>
//                  <b>{c.id}  {c.type}</b>  
//                 </li>
//             </ul>
//         </li>
//     </ul> 





   
</script>
</html>
